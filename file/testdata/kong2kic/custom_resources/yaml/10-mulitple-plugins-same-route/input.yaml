services:
  - name: example-service
    url: http://example-api.com
    protocol: http
    host: example-api.com
    port: 80
    path: /v1
    retries: 5
    connect_timeout: 5000
    write_timeout: 60000
    read_timeout: 60000
    enabled: true
    client_certificate: 4e3ad2e4-0bc4-4638-8e34-c84a417ba39b
    tags:
      - example
      - api
    routes:
      - name: example-route
        methods:
          - GET
          - POST
        hosts:
          - example.com
        paths:
          - /v1/example
        protocols:
          - http
          - https
        headers:
          x-my-header:
            - foo
            - bar
          x-another-header:
            - bla
        regex_priority: 1
        strip_path: false
        preserve_host: true
        tags:
          - version:v1
        https_redirect_status_code: 302
        snis:
          - example.com
        sources:
          - ip: 192.168.0.1
        plugins:
          - name: aws-lambda
            config:
              aws_key: my_key
              aws_secret: my_secret
              function_name: my_function
              aws_region: us-west-2
          - name: cors
            config:
              origins:
                - example.com
              methods:
                - GET
                - POST
              headers:
                - Authorization
              exposed_headers:
                - X-My-Header
              max_age: 3600
              credentials: true
          - name: file-log
            config:
              path: /var/log/kong/kong.log
              reopen: true
          - name: http-log
            config:
              http_endpoint: http://example.com/logs
              method: POST
              content_type: application/json
              timeout: 10000
              keepalive: 60000
              retry_count: 10
              queue_size: 1000
          - name: ip-restriction
            config:
              allow:
                - 192.168.0.1/24
              deny:
                - 192.168.0.2/32
          - name: rate-limiting-advanced
            config:
              limit:
              - 5
              window_size:
              - 30
              identifier: consumer
              sync_rate: -1
              namespace: example_namespace
              strategy: local
              hide_client_headers: false
          - name: request-termination
            config:
              status_code: 403
              message: Forbidden
          - name: response-ratelimiting
            config:
              limits:
                limit_name:
                  minute: 10
              policy: local
          - name: tcp-log
            config:
              host: example.com
              port: 1234
upstreams:
  - name: example-api.com
    algorithm: round-robin
    hash_on: none
    hash_fallback: none
    hash_on_cookie_path: "/"
    slots: 10000
    healthchecks:
      passive:
        type: http
        healthy:
          http_statuses:
          - 200
          - 201
          - 202
          - 203
          - 204
          - 205
          - 206
          - 207
          - 208
          - 226
          - 300
          - 301
          - 302
          - 303
          - 304
          - 305
          - 306
          - 307
          - 308
          successes: 0
        unhealthy:
          http_statuses:
          - 429
          - 500
          - 503
          timeouts: 0
          http_failures: 0
          tcp_failures: 0
      active:
        https_verify_certificate: true
        healthy:
          http_statuses:
          - 200
          - 302
          successes: 0
          interval: 0
        unhealthy:
          http_failures: 0
          http_statuses:
          - 429
          - 404
          - 500
          - 501
          - 502
          - 503
          - 504
          - 505
          timeouts: 0
          tcp_failures: 0
          interval: 0
        type: http
        concurrency: 10
        headers:
          x-my-header:
            - foo
            - bar
          x-another-header:
            - bla
        timeout: 1
        http_path: "/"
        https_sni: example.com
      threshold: 0
    tags:
    - user-level
    - low-priority
    host_header: example.com
    client_certificate:
      id: ea29aaa3-3b2d-488c-b90c-56df8e0dd8c6
    use_srv_name: false
consumers:
  - username: example-user
    custom_id: "1234567890"
    tags:
      - internal